{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { useNavigation } from '@react-navigation/native';\nimport React, { useState } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport View from \"react-native-web/dist/exports/View\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport { ref, uploadBytes, uploadBytesResumable, uploadString, getDownloadURL } from \"firebase/storage\";\nimport { Ionicons, MaterialIcons } from '@expo/vector-icons';\nimport { useAuthentication } from \"../../utils/hooks/useAuthentication\";\nimport { storage, db } from \"../../config/firebase\";\nimport { setDoc, doc } from 'firebase/firestore';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar ImageSocial = function ImageSocial(_ref) {\n  var route = _ref.route;\n  var navigation = useNavigation();\n  var photo = route.params.photo;\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      caption = _useState2[0],\n      setCaption = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      imgUrl = _useState4[0],\n      setImgUrl = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      uploading = _useState6[0],\n      setUploading = _useState6[1];\n\n  var _useAuthentication = useAuthentication(),\n      user = _useAuthentication.user;\n\n  var sharePost = function _callee() {\n    var dateTime, imageRef, img, bytes, uploadTask;\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            setUploading(true);\n            dateTime = Date.now() + '';\n            imageRef = ref(storage, user.email + \"/images/\" + dateTime);\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(fetch(photo.uri));\n\n          case 5:\n            img = _context.sent;\n            _context.next = 8;\n            return _regeneratorRuntime.awrap(img.blob());\n\n          case 8:\n            bytes = _context.sent;\n            _context.next = 11;\n            return _regeneratorRuntime.awrap(uploadBytesResumable(imageRef, bytes));\n\n          case 11:\n            uploadTask = _context.sent;\n            getDownloadURL(imageRef).then(function (downloadURL) {\n              try {\n                var postRef = doc(db, \"users\", user.email, \"posts\", dateTime);\n                setDoc(postRef, {\n                  name: dateTime,\n                  url: downloadURL,\n                  caption: caption\n                });\n              } catch (error) {\n                console.log(error);\n              }\n\n              setUploading(false);\n              setCaption('');\n              navigation.navigate(\"Social\");\n            });\n\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var PostHeader = function PostHeader() {\n    var navigation = useNavigation();\n    return _jsxs(View, {\n      style: headerStyles.header,\n      children: [_jsx(Button, {\n        title: \"Cancel\",\n        onPress: function onPress() {\n          return navigation.navigate('Social');\n        }\n      }), _jsx(Text, {\n        style: headerStyles.titleText,\n        children: \"Post\"\n      }), _jsx(Button, {\n        title: \"Share\",\n        onPress: sharePost\n      })]\n    });\n  };\n\n  return _jsxs(SafeAreaView, {\n    style: styles.imagePrev,\n    children: [_jsx(PostHeader, {}), _jsx(View, {\n      style: {\n        marginVertical: 10,\n        justifyContent: 'center',\n        alignItems: 'center'\n      },\n      children: uploading && _jsx(Text, {\n        style: {\n          color: 'gray'\n        },\n        children: \"Uploading in progress...\"\n      })\n    }), _jsx(ScrollView, {\n      keyboardShouldPersistTaps: \"handled\",\n      children: _jsxs(View, {\n        style: styles.comment,\n        children: [_jsx(ImageBackground, {\n          source: {\n            uri: photo && photo.uri\n          },\n          style: styles.itemPhoto\n        }), _jsx(TextInput, {\n          value: caption,\n          style: styles.input,\n          multiline: true,\n          textAlignVertical: \"top\",\n          placeholder: \"Comment...\",\n          onChangeText: function onChangeText(text) {\n            return setCaption(text);\n          }\n        })]\n      })\n    })]\n  });\n};\n\nvar headerStyles = StyleSheet.create({\n  header: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    paddingHorizontal: 10,\n    height: '6%',\n    backgroundColor: '#fff',\n    borderBottomColor: '#808080',\n    borderBottomWidth: StyleSheet.hairlineWidth\n  },\n  titleText: {\n    fontSize: 18,\n    fontWeight: '600'\n  }\n});\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    justifyContent: 'center',\n    backgroundColor: '#fff'\n  },\n  sectionHeader: {\n    fontWeight: '700',\n    fontSize: 19,\n    color: '#000000',\n    marginTop: 20,\n    marginBottom: 10\n  },\n  item: {\n    paddingRight: 20\n  },\n  itemPhoto: {\n    aspectRatio: 1,\n    height: 80,\n    margin: 8\n  },\n  itemText: {\n    color: '#000000',\n    marginTop: 5\n  },\n  imagePrev: {\n    backgroundColor: 'white',\n    flex: 1\n  },\n  cancelButton: {\n    position: 'absolute',\n    top: 60,\n    left: 20,\n    flex: 0.1,\n    color: '#fff'\n  },\n  secondScreen: {\n    position: 'absolute',\n    bottom: 55,\n    right: 20,\n    flex: 0.1,\n    color: '#fff'\n  },\n  text: {\n    fontSize: 20,\n    color: 'white'\n  },\n  input: {\n    flex: 1,\n    marginVertical: 10,\n    paddingHorizontal: 6\n  },\n  comment: {\n    flexDirection: 'row',\n    height: 95,\n    borderBottomColor: '#808080',\n    borderBottomWidth: StyleSheet.hairlineWidth\n  },\n  wheel: {\n    marginVertical: 10,\n    justifyContent: 'center',\n    alignItems: 'center'\n  }\n});\nexport default ImageSocial;","map":{"version":3,"names":["useNavigation","React","useState","ref","uploadBytes","uploadBytesResumable","uploadString","getDownloadURL","Ionicons","MaterialIcons","useAuthentication","storage","db","setDoc","doc","ImageSocial","route","navigation","photo","params","caption","setCaption","imgUrl","setImgUrl","uploading","setUploading","user","sharePost","dateTime","Date","now","imageRef","email","fetch","uri","img","blob","bytes","uploadTask","then","downloadURL","postRef","name","url","error","console","log","navigate","PostHeader","headerStyles","header","titleText","styles","imagePrev","marginVertical","justifyContent","alignItems","color","comment","itemPhoto","input","text","StyleSheet","create","flexDirection","paddingHorizontal","height","backgroundColor","borderBottomColor","borderBottomWidth","hairlineWidth","fontSize","fontWeight","container","flex","sectionHeader","marginTop","marginBottom","item","paddingRight","aspectRatio","margin","itemText","cancelButton","position","top","left","secondScreen","bottom","right","wheel"],"sources":["/Users/davidnguyen/Desktop/fixfit/components/Social/ImageSocial.js"],"sourcesContent":["import { useNavigation } from '@react-navigation/native';\nimport React, { useState } from 'react';\nimport {\n  StyleSheet,\n  SafeAreaView,\n  View,\n  ImageBackground,\n  Button,\n  Text,\n  TouchableOpacity,\n  TextInput,\n  ScrollView\n} from 'react-native';\nimport { ref, uploadBytes, uploadBytesResumable, uploadString, getDownloadURL } from \"firebase/storage\";\nimport { Ionicons, MaterialIcons } from '@expo/vector-icons';\nimport { useAuthentication } from '../../utils/hooks/useAuthentication';\nimport { storage, db } from '../../config/firebase'\nimport { setDoc, doc } from 'firebase/firestore'\n\n\nconst ImageSocial = ({route}) => {\n    const navigation = useNavigation();\n    const { photo } = route.params;\n    const [ caption, setCaption ] = useState('');\n    const [ imgUrl, setImgUrl ] = useState('');\n    const [ uploading, setUploading ] = useState(false);\n    //const [ percent, setPercent ] = useState(0);\n\n    const { user } = useAuthentication();\n\n    const sharePost = async () => {\n\n      setUploading(true);\n\n      const dateTime = Date.now() + '';\n      const imageRef = ref(storage, `${user.email}/images/${dateTime}`);\n\n      const img = await fetch(photo.uri);\n      const bytes = await img.blob();\n      const uploadTask = await uploadBytesResumable(imageRef, bytes);\n\n      getDownloadURL(imageRef).then((downloadURL) => {\n        try {\n          const postRef = doc(db, \"users\", user.email, \"posts\", dateTime);\n          setDoc(postRef, {\n            name: dateTime,\n            url: downloadURL,\n            caption: caption\n          })\n        }\n        catch(error) {\n          console.log(error);\n        }\n\n        setUploading(false);\n        setCaption('');\n        navigation.navigate(\"Social\"); //use with await\n      });\n\n      //Progress bar sometimes working, not all the time\n      // uploadTask.on('state_changed',\n      //   (snapshot) => {\n      //     setPercent(Math.round((snapshot.bytesTransferred / snapshot.totalBytes) * 100 / 100));\n      //   },\n      //   (error) => {\n      //     alert(error);\n      //   },\n      //   () => {\n      //     navigation.navigate(\"Social\");\n      //   })\n    }\n\n    const PostHeader = () => {\n\n      const navigation = useNavigation();\n    \n      return (\n        <View style={headerStyles.header}>\n          <Button \n            title=\"Cancel\" \n            onPress={() => navigation.navigate('Social')}\n          />\n          <Text style={headerStyles.titleText}>Post</Text>\n          <Button \n            title=\"Share\" \n            onPress={sharePost}\n          />\n        </View>\n      )\n    }\n    \n    return (\n      <SafeAreaView style={styles.imagePrev}>\n        <PostHeader />\n          <View style={{ marginVertical: 10, justifyContent: 'center', alignItems: 'center' }}>\n              { uploading && <Text style={{ color: 'gray' }}>Uploading in progress...</Text> }\n          </View>\n        <ScrollView keyboardShouldPersistTaps='handled'>\n          <View \n            style={styles.comment}\n          >\n            <ImageBackground\n                source={{uri: photo && photo.uri}}\n                style={styles.itemPhoto}\n            />\n            <TextInput \n                value={caption}\n                style={styles.input}\n                multiline={true}\n                textAlignVertical=\"top\"\n                placeholder=\"Comment...\"\n                onChangeText={(text) => setCaption(text)}\n            />\n          </View> \n        </ScrollView>\n      </SafeAreaView>\n    )\n};\n\nconst headerStyles = StyleSheet.create({\n  header: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    paddingHorizontal: 10,\n    height: '6%',\n    backgroundColor: '#fff',\n    borderBottomColor: '#808080',\n    borderBottomWidth: StyleSheet.hairlineWidth,\n  },\n  titleText: {\n    fontSize: 18,\n    fontWeight: '600'\n  }\n})\n\nconst styles = StyleSheet.create({\n    container: {\n      flex: 1,\n      justifyContent: 'center',\n      backgroundColor: '#fff',\n    },\n    sectionHeader: {\n      fontWeight: '700',\n      fontSize: 19,\n      color: '#000000',\n      marginTop: 20,\n      marginBottom: 10,\n    },\n    item: {\n      paddingRight: 20\n    },\n    itemPhoto: {\n      aspectRatio: 1,\n      height: 80,\n      margin: 8\n    },\n    itemText: {\n      color: '#000000',\n      marginTop: 5,\n    },\n    imagePrev: {\n      backgroundColor: 'white',\n      flex: 1,\n      // width: '100%',\n      // height: '100%'\n    },\n    cancelButton: {\n      position: 'absolute',\n      top: 60,\n      left: 20,\n      flex: 0.1,\n      color: '#fff',\n    },\n    secondScreen: {\n      position: 'absolute',\n      bottom: 55,\n      right: 20,\n      flex: 0.1,\n      color: '#fff',\n    },\n    text: {\n        fontSize: 20,\n        color: 'white',\n    },\n    input: {\n      flex: 1,\n      marginVertical: 10,\n      paddingHorizontal: 6,\n    },\n    comment: {\n      flexDirection: 'row',\n      height: 95,\n      borderBottomColor: '#808080',\n      borderBottomWidth: StyleSheet.hairlineWidth,\n    },\n    wheel: {\n        marginVertical: 10,\n        justifyContent: 'center',\n        alignItems: 'center',\n    }\n  });\n\nexport default ImageSocial;"],"mappings":"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"},"metadata":{},"sourceType":"module"}