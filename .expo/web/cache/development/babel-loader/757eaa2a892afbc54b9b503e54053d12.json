{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { StatusBar } from 'expo-status-bar';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport { Header } from \"../navigation/Header\";\nimport { useAuthentication } from \"../utils/hooks/useAuthentication\";\nimport { storage, db } from \"../config/firebase\";\nimport { ref, uploadBytes, getDownloadURL, listAll, deleteObject } from \"firebase/storage\";\nimport React, { useState, useEffect } from 'react';\nimport { getAuth, onAuthStateChanged } from \"firebase/auth\";\nimport { doc, getDoc, getDocs, collection, query, where, orderBy } from \"firebase/firestore\";\nimport { useIsFocused } from '@react-navigation/native';\nimport { set } from 'firebase/database';\nimport CachedImage from 'expo-cached-image';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nvar auth = getAuth();\n\nvar Category = function Category(props) {\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      urls = _useState2[0],\n      setUrls = _useState2[1];\n\n  var isFocused = useIsFocused();\n  useEffect(function () {\n    var fetchData = function _callee() {\n      var q, querySnapshot;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              q = query(collection(db, \"users\", props.email, props.name), orderBy(\"name\", \"desc\"));\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(getDocs(q));\n\n            case 3:\n              querySnapshot = _context.sent;\n              setUrls([]);\n              querySnapshot.forEach(function (doc) {\n                var obj = {\n                  key: doc.data().name,\n                  url: doc.data().url\n                };\n                console.log('set');\n                setUrls(function (urls) {\n                  return [].concat(_toConsumableArray(urls), [obj]);\n                });\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    try {\n      fetchData();\n    } catch (error) {\n      console.log(error);\n    }\n  }, [isFocused]);\n  return _jsx(_Fragment, {\n    children: _jsx(View, {\n      style: styles.container,\n      children: _jsx(SafeAreaView, {\n        style: {\n          flex: 1\n        },\n        children: _jsx(FlatList, {\n          data: urls,\n          renderItem: function renderItem(_ref) {\n            var item = _ref.item;\n            return _jsx(Item, {\n              item: item\n            });\n          },\n          showsVerticalScrollIndicator: false\n        })\n      })\n    })\n  });\n};\n\nvar Item = function Item(_ref2) {\n  var item = _ref2.item;\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isVisible = _useState4[0],\n      setVisible = _useState4[1];\n\n  var deletePost = function _callee2() {\n    var storageRef;\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(deleteDoc(doc(db, \"users\", item.email, \"posts\", item.postName)));\n\n          case 2:\n            storageRef = ref(storage, item.email + \"/images/\" + item.postName);\n\n            try {\n              deleteObject(storageRef);\n            } catch (error) {\n              console.log(error);\n            }\n\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  return _jsx(View, {\n    style: {\n      flex: 1,\n      flexDirection: 'column',\n      paddingVertical: 15\n    },\n    children: _jsx(CachedImage, {\n      source: {\n        uri: item.uri\n      },\n      cacheKey: item.key,\n      placeholderContent: _jsx(ActivityIndicator, {\n        size: \"small\",\n        style: {\n          flex: 1,\n          justifyContent: \"center\"\n        }\n      }),\n      resizeMode: \"contain\",\n      style: styles.image\n    })\n  });\n};\n\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: \"center\",\n    justifyContent: 'center'\n  },\n  image: {\n    width: 300,\n    height: 300,\n    paddingTop: 10\n  }\n});\nexport default Category;","map":{"version":3,"names":["StatusBar","Header","useAuthentication","storage","db","ref","uploadBytes","getDownloadURL","listAll","deleteObject","React","useState","useEffect","getAuth","onAuthStateChanged","doc","getDoc","getDocs","collection","query","where","orderBy","useIsFocused","set","CachedImage","auth","Category","props","urls","setUrls","isFocused","fetchData","q","email","name","querySnapshot","forEach","obj","key","data","url","console","log","error","styles","container","flex","item","Item","isVisible","setVisible","deletePost","deleteDoc","postName","storageRef","flexDirection","paddingVertical","uri","justifyContent","image","StyleSheet","create","backgroundColor","alignItems","width","height","paddingTop"],"sources":["/Users/davidnguyen/Desktop/fixfit/pages/Category.js"],"sourcesContent":["import { StatusBar } from 'expo-status-bar';\nimport { StyleSheet, Text, View, TouchableOpacity, Image, ScrollView, FlatList, SafeAreaView, ActivityIndicator } from 'react-native';\nimport { Header } from '../navigation/Header';\nimport { useAuthentication } from '../utils/hooks/useAuthentication';\nimport { storage, db } from '../config/firebase';\nimport { ref, uploadBytes, getDownloadURL, listAll, deleteObject } from \"firebase/storage\";\nimport React, { useState, useEffect } from 'react';\nimport { getAuth, onAuthStateChanged } from \"firebase/auth\";\nimport { doc, getDoc, getDocs, collection, query, where, orderBy } from \"firebase/firestore\";\nimport { useIsFocused } from '@react-navigation/native';\nimport { set } from 'firebase/database';\n\nimport CachedImage from 'expo-cached-image'\n\nconst auth = getAuth();\n\nconst Category = (props) => {\n  const [urls, setUrls] = useState([]);\n  const isFocused = useIsFocused();\n\n  useEffect(() => {\n    const fetchData = async () => {\n      const q = query(collection(db, \"users\", props.email, props.name), orderBy(\"name\", \"desc\"));\n      const querySnapshot = await getDocs(q);\n      setUrls([]);\n      querySnapshot.forEach((doc) => {\n        // doc.data() is never undefined for query doc snapshots\n        const obj = {\n          key: doc.data().name,\n          url: doc.data().url\n        }\n        console.log('set');\n        setUrls(urls => [...urls, obj]);\n      });\n    }\n    try {\n      fetchData();\n    } catch(error) {\n      console.log(error);\n    }\n  }, [isFocused]);\n\n  return (\n    <>\n      <View style={styles.container}>\n        <SafeAreaView style={{ flex: 1 }}>\n          <FlatList\n            data={urls}\n            renderItem={({ item }) => <Item item={item} />}\n            showsVerticalScrollIndicator={false}\n          />\n        </SafeAreaView>\n      </View>\n    </>\n  );\n}\n\nconst Item = ({item}) => {\n  const [isVisible, setVisible] = useState(false);\n\n  const deletePost = async () => {\n    await deleteDoc(doc(db, \"users\", item.email, \"posts\", item.postName));\n\n    const storageRef = ref(storage, `${item.email}/images/${item.postName}`);\n\n    try {\n      deleteObject(storageRef);\n    } catch(error) {\n      console.log(error);\n    }\n  }\n\n  return (\n    <View style={{ flex: 1, flexDirection: 'column', paddingVertical: 15}}>\n      <CachedImage\n          source={{ \n            uri: item.uri, // (required) -- URI of the image to be cached         \n          }}\n          cacheKey={item.key} // (required) -- key to store image locally\n          placeholderContent={( // (optional) -- shows while the image is loading\n            <ActivityIndicator // can be any react-native tag\n              size=\"small\"\n              style={{\n                flex: 1,\n                justifyContent: \"center\",\n              }}\n            />\n          )} \n          resizeMode=\"contain\" // pass-through to <Image /> tag \n          style={styles.image} // pass-through to <Image /> tag s\n        />\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: \"center\", \n    justifyContent: 'center',\n  },\n  image: {\n    width: 300,\n    height: 300,\n    paddingTop: 10\n  },\n});\n\nexport default Category;"],"mappings":"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"},"metadata":{},"sourceType":"module"}